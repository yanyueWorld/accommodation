<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>四川民宿管理系统</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="layui/layui.js"></script>
    <script src="js/index.js"></script>
    <script src="js/jquery.js"></script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">四川民宿电商平台</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a href="javascript:void(0);" onclick="aClick(this)" data-url="page/consolePage/console.html">控制台</a></li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <span id="real-name"></span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:void(0);" onclick="aClick(this)" data-url="page/consolePage/baseInfo.html">基本资料</a></dd>
                    <dd><a href="javascript:void(0);" onclick="aClick(this)" data-url="page/consolePage/setting.html">安全设置</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a href="javascript:;" id="logout">退了</a></li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree"  lay-filter="test" id="power-tree">
            </ul>

        </div>
    </div>

    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div style="padding: 15px;" id="content_body">
        </div>

    </div>

    <div class="layui-footer">
        <!-- 底部固定区域 -->
        &copy 四川民宿电商平台
    </div>
</div>

<script>
    //JavaScript代码区域
    layui.use(['element','jquery','tree','layer'], function(){
        var element = layui.element;
        var $=layui.$;
        var layer=layui.layer;
        //登录权限加载

        $(document).ready(function(){
            var realName=$("#real-name");
            $.ajax({
                url:"/getAccountPower",
                type:"post",
                dataType:"json",
                success:function(res){
                    if(res.length==0){
                        layer.msg("登录信息失效，请重新登录,稍后自动跳转至登录页面",{
                            time:2000,
                        })
                        setTimeout(function(){
                            window.location.href="login.html";
                        },2000)
                    }
                    realName.html(res[0].accountName);
                    for(i=0;i<res.length;i++){
                        layui.tree({
                            elem:'#power-tree',
                            nodes:[{
                                name:res[i].resourceName,
                                id:res[i].resourceId,
                                url:res[i].url
                            }],
                            click:function(node){
                                var contentBody=$("#content_body");
                                /*console.log(contentBody);
                                console.log(node);*/
                                $.ajax({
                                    url:node.url,
                                    type:"get",
                                    dataType:"text",
                                    success:function(msg){
                                        $("#content_body").html(msg);
                                        //console.log(node);
                                    }
                                });
                            }
                        })
                    }

                }//success_end
            })//ajax_end
        })
        $(document).ready(function () {
            $.ajax({
                url:"page/consolePage/console.html",
                type:"get",
                dataType:"text",
                success:function(res){
                    $("#content_body").html(res);
                }
            })
        })
        //退出
        $("#logout").click(function () {
            layer.open({
                type:1,
                content:"<div style='text-align:center;'>确认退出？</div>",
                btn:["确认","取消"],
                yes:function (index) {
                    window.location.href="/logout";

                },
                btn2:function (index) {
                    layer.close();
                }
            })
        })
    });
</script>
</body>
</html>